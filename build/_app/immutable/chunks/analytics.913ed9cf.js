import{w as p,s as r,u as s,b as f,d as u,e as d,h as x,j as g,k as S}from"./firebase.131ce329.js";import{c as b,g as w,a as y}from"./stores.ee858f52.js";function m(e,t,i){var c,$;const o={icon:i.type==="course"?i.icon:(c=i.frontMatter)!=null&&c.icon?{type:i.frontMatter.icon.type,color:i.frontMatter.icon.color}:{},img:i.img,title:i.title,courseTitle:t.lo.title,subRoute:i.route,isPrivate:($=t.lo.properties)!=null&&$.private?t.lo.properties.private:0,tutorsTimeId:v(t)};p(`${e}/lo`,o)}function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function v(e){return e.authLevel>0?window.localStorage.id:(window.localStorage.tutorsTimeId||(window.localStorage.tutorsTimeId=h()),window.localStorage.tutorsTimeId)}let a,n,l;b.subscribe(e=>{a=e});w.subscribe(e=>{n=e});y.subscribe(e=>{l=e});const k={loRoute:"",learningEvent(e,t){e.loid&&(this.loRoute=r(e.loid)),this.reportPageLoad(t)},setOnlineStatus(e,t){const i=e?"online":"offline",o=`${a.id}/users/${r(t.user.email)}/onlineStatus`;s(o,i)},async getOnlineStatus(e,t){if(!e||!n)return"online";const o=`${e.url.substring(0,e.url.indexOf("."))}/users/${r(t.user.email)}/onlineStatus`;return await f(o)||"online"},reportPageLoad(e){if(u(`${a.id}/usage/${this.loRoute}`,a.lo.title),d(a.url.substring(0,a.url.indexOf("."))),(!e||e&&e.onlineStatus==="online")&&(u(`all-course-access/${a.id}`,a.lo.title),d(`all-course-access/${a.id}`),m(`all-course-access/${a.id}`,a,l)),e){const t=`${a.url.substring(0,a.url.indexOf("."))}/users/${r(e.user.email)}/${this.loRoute}`;u(t,l.title),d(t)}},updatePageCount(e){if(u(`${a.id}/usage/${this.loRoute}`,a.lo.title),x(a.id),n){x(`all-course-access/${a.id}`),n.onlineStatus==="online"&&m(`all-course-access/${a.id}`,a,l);const t=`${a.id}/users/${r(e.user.email)}/${this.loRoute}`;u(t,l.title),x(t),g(`${a.id}/users/${r(e.user.email)}`)}},updateLogin(e,t){const i=`${e}/users/${r(t.user.email)}`;s(`${i}/email`,t.user.email),s(`${i}/name`,t.user.user_metadata.full_name),s(`${i}/id`,t.user.id),s(`${i}/nickname`,t.user.user_metadata.preferred_username),s(`${i}/picture`,t.user.user_metadata.avatar_url),s(`${i}/last`,new Date().toString()),S(`${i}/count`)}};export{k as a};
