import{c as f}from"../chunks/course.0b79902e.js";import{a as l}from"../chunks/stores.ee858f52.js";import{s as p,o as _}from"../chunks/scheduler.a12d0be3.js";import{S as g,i as S,b,d as w,m as v,a as y,t as $,e as h}from"../chunks/index.208b70fa.js";import{g as I}from"../chunks/navigation.a50e4eb6.js";import{a as O}from"../chunks/analytics.913ed9cf.js";import{i as x}from"../chunks/firebase.131ce329.js";import{g as d}from"../chunks/environment.17b2d52b.js";import{T as D}from"../chunks/TopDeck.518859fc.js";const L=!1,k=async({params:a,parent:t,fetch:r})=>{var o,i;const e=await f.readCourse(a.courseid,r),s=await t();if(!s.session)return l.set(e.lo),{course:e,lo:e.lo};if(s.session&&!((i=(o=e.lo)==null?void 0:o.properties)!=null&&i.parent)){const{data:c}=await s.supabase.from("accessed_courses").select("course_list").eq("id",s.session.user.id);if(!c||c.length===0)await s.supabase.from("accessed_courses").insert([{id:s.session.user.id,course_list:{courses:[{id:e.id,name:e.lo.title,last_accessed:new Date().toISOString(),visits:1}]}}]);else{const n=c[0].course_list,u=n.courses.findIndex(m=>m.id===e.id);u===-1?n.courses.push({id:e.id,name:e.lo.title,last_accessed:new Date().toISOString(),visits:1}):(n.courses[u].last_accessed=new Date().toISOString(),n.courses[u].visits++),await s.supabase.from("accessed_courses").update({course_list:n}).eq("id",s.session.user.id)}}return l.set(e.lo),{course:e,lo:e.lo}},B=Object.freeze(Object.defineProperty({__proto__:null,load:k,ssr:L},Symbol.toStringTag,{value:"Module"}));function q(a){let t,r;return t=new D({props:{lo:a[0].course.lo}}),{c(){b(t.$$.fragment)},l(e){w(t.$$.fragment,e)},m(e,s){v(t,e,s),r=!0},p(e,[s]){const o={};s&1&&(o.lo=e[0].course.lo),t.$set(o)},i(e){r||(y(t.$$.fragment,e),r=!0)},o(e){$(t.$$.fragment,e),r=!1},d(e){h(t,e)}}}function C(a,t,r){let e,s,{data:o}=t;return _(async()=>{o.course.authLevel>0&&(s?s.onlineStatus=await O.getOnlineStatus(o.course,s):(localStorage.setItem("course_url",o.course.url),localStorage.setItem("isAuthenticating","true"),I("/auth"))),d().firebase.apiKey!=="XXX"&&x(d().firebase)}),a.$$set=i=>{"data"in i&&r(0,o=i.data)},a.$$.update=()=>{a.$$.dirty&1&&({supabase:e,session:s}=o)},[o]}class E extends g{constructor(t){super(),S(this,t,C,q,p,{data:0})}}export{E as component,B as universal};
