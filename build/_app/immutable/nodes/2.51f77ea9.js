import{s as safe_not_equal,e as empty,i as insert_hydration,r as noop,d as detach,w as create_slot,f as element,g as claim_element,h as children,x as update_slot_base,y as get_all_dirty_from_scope,z as get_slot_changes,L as add_render_callback,v as get_store_value,a as space,_ as head_selector,c as claim_space,X as get_svelte_dataset,j as attr,k as set_style,F as append_hydration,a0 as set_input_value,G as listen,H as run_all,S as component_subscribe,o as onMount,l as text,m as claim_text,n as set_data}from"../chunks/scheduler.a12d0be3.js";import{S as SvelteComponent,i as init,g as group_outros,t as transition_out,c as check_outros,a as transition_in,k as create_in_transition,o as create_out_transition,b as create_component,d as claim_component,m as mount_component,e as destroy_component}from"../chunks/index.208b70fa.js";import{g as globals}from"../chunks/globals.7f7f1b26.js";import{p as page}from"../chunks/stores.0392801f.js";import{g as goto,a as afterNavigate}from"../chunks/navigation.a50e4eb6.js";import{s as setInitialClassState}from"../chunks/ProgressBar.svelte_svelte_type_style_lang.0f792c6b.js";import{c as currentCourse,t as transitionKey,b as studentsOnline,f as studentsOnlineList,o as onlineStatus,a as currentLo}from"../chunks/stores.ee858f52.js";import{f as fly}from"../chunks/index.00aac393.js";import{g as getKeys}from"../chunks/environment.17b2d52b.js";import{a as analyticsService}from"../chunks/analytics.913ed9cf.js";import{i as initFirebase}from"../chunks/firebase.131ce329.js";function create_key_block(e){let t,l,a,n;const o=e[2].default,s=create_slot(o,e,e[1],null);return{c(){t=element("div"),s&&s.c()},l(r){t=claim_element(r,"DIV",{});var i=children(t);s&&s.l(i),i.forEach(detach)},m(r,i){insert_hydration(r,t,i),s&&s.m(t,null),n=!0},p(r,i){s&&s.p&&(!n||i&2)&&update_slot_base(s,o,r,r[1],n?get_slot_changes(o,r[1],i,null):get_all_dirty_from_scope(r[1]),null)},i(r){n||(transition_in(s,r),r&&add_render_callback(()=>{n&&(a&&a.end(1),l=create_in_transition(t,fly,{y:-50,duration:250,delay:300}),l.start())}),n=!0)},o(r){transition_out(s,r),l&&l.invalidate(),r&&(a=create_out_transition(t,fly,{y:-50,duration:250})),n=!1},d(r){r&&detach(t),s&&s.d(r),r&&a&&a.end()}}}function create_fragment$1(e){let t=e[0],l,a,n=create_key_block(e);return{c(){n.c(),l=empty()},l(o){n.l(o),l=empty()},m(o,s){n.m(o,s),insert_hydration(o,l,s),a=!0},p(o,[s]){s&1&&safe_not_equal(t,t=o[0])?(group_outros(),transition_out(n,1,1,noop),check_outros(),n=create_key_block(o),n.c(),transition_in(n,1),n.m(l.parentNode,l)):n.p(o,s)},i(o){a||(transition_in(n),a=!0)},o(o){transition_out(n),a=!1},d(o){o&&detach(l),n.d(o)}}}function instance$1(e,t,l){let{$$slots:a={},$$scope:n}=t,{url:o=""}=t;return e.$$set=s=>{"url"in s&&l(0,o=s.url),"$$scope"in s&&l(1,n=s.$$scope)},[o,n,a]}class PageTransition extends SvelteComponent{constructor(t){super(),init(this,t,instance$1,create_fragment$1,safe_not_equal,{url:0})}}async function initServices(e){if(getKeys().firebase.apiKey!=="XXX"){initFirebase(getKeys().firebase);const t=get_store_value(page);if(t.url.hash)t.url.hash.startsWith("#/course")&&goto(t.url.hash.slice(2));else if(get_store_value(currentCourse)){const l=get_store_value(currentCourse);e&&l&&analyticsService.updateLogin(l.id,e)}}page.subscribe(t=>{if(t.url.hash.startsWith("#/course")){const l=t.url.hash.slice(1);goto(l)}transitionKey.set(t.url.pathname),(t.url.pathname.includes("book")||t.url.pathname.includes("pdf")||t.url.pathname.includes("video")||t.url.pathname.includes("note"))&&transitionKey.set("none")})}let presenceChannel;function setupPresence(e,t){presenceChannel=e.channel("online-users",{config:{presence:{key:t}}})}function updatePresence(e){presenceChannel.track({online_at:new Date().toISOString(),studentName:e.studentName,studentEmail:e.studentEmail,studentImg:e.studentImg,courseTitle:e.courseTitle,loTitle:e.loTitle,loImage:e.loImage,loRoute:e.loRoute,loIcon:e.loIcon})}function subscribePresence(e,t){try{presenceChannel.subscribe(async l=>{l==="SUBSCRIBED"&&await presenceChannel.track({online_at:new Date().toISOString(),studentName:e.studentName,studentEmail:e.studentEmail,studentImg:e.studentImg,courseTitle:e.courseTitle,loTitle:e.loTitle,loImage:e.loImage,loRoute:e.loRoute,loIcon:e.loIcon})})}catch(l){return l}presenceChannel.on("presence",{event:"sync"},()=>{const l=presenceChannel.presenceState(),a=t.replace(".netlify.app",""),n=`${a}.netlify.app`,o=[];for(const[s,r]of Object.entries(l))(s===a||s===n)&&o.push(...r);studentsOnline.set(o.length),studentsOnlineList.set(o)}),presenceChannel.on("presence",{event:"join"},({newPresences:l})=>{const a=t.replace(".netlify.app",""),n=`${a}.netlify.app`,o=l.filter(s=>s.channel===a||s.channel===n);studentsOnline.update(s=>s+o.length),studentsOnlineList.update(s=>[...s,...o])}),presenceChannel.on("presence",{event:"leave"},({leftPresences:l})=>{const a=t.replace(".netlify.app",""),n=`${a}.netlify.app`,o=l.filter(s=>s.channel===a||s.channel===n);studentsOnline.update(s=>s-o.length),studentsOnlineList.update(s=>s.filter(r=>!o.some(i=>i.user_id===r.studentEmail)))})}function unsubscribePresence(){presenceChannel.untrack().then(()=>{console.log("untrack")})}const{document:document_1}=globals;function create_else_block(e){return{c(){this.h()},l(t){this.h()},h(){document_1.title="Tutors Course Reader"},m:noop,d:noop}}function create_if_block_2(e){return document_1.title=e[0].title,{c:noop,l:noop,m:noop,d:noop}}function create_default_slot(e){let t;const l=e[12].default,a=create_slot(l,e,e[17],null);return{c(){a&&a.c()},l(n){a&&a.l(n)},m(n,o){a&&a.m(n,o),t=!0},p(n,o){a&&a.p&&(!t||o&131072)&&update_slot_base(a,l,n,n[17],t?get_slot_changes(l,n[17],o,null):get_all_dirty_from_scope(n[17]),null)},i(n){t||(transition_in(a,n),t=!0)},o(n){transition_out(a,n),t=!1},d(n){a&&a.d(n)}}}function create_if_block_1(e){let t,l;return{c(){t=element("div"),l=text(e[2]),this.h()},l(a){t=claim_element(a,"DIV",{class:!0});var n=children(t);l=claim_text(n,e[2]),n.forEach(detach),this.h()},h(){attr(t,"class","example-code")},m(a,n){insert_hydration(a,t,n),append_hydration(t,l)},p(a,n){n&4&&set_data(l,a[2])},d(a){a&&detach(t)}}}function create_if_block(e){let t,l=`<div class="example-code">// Construye un saludo personalizado<br/>
            var nombre = &quot;Juan&quot;;<br/>
            var saludo = &quot;¡Hola, &quot; + nombre + &quot;!&quot;;<br/><br/></div>`,a,n,o="Cerrar Ejemplo",s,r;return{c(){t=element("div"),t.innerHTML=l,a=space(),n=element("button"),n.textContent=o,this.h()},l(i){t=claim_element(i,"DIV",{class:!0,"data-svelte-h":!0}),get_svelte_dataset(t)!=="svelte-1i78usg"&&(t.innerHTML=l),a=claim_space(i),n=claim_element(i,"BUTTON",{"data-svelte-h":!0}),get_svelte_dataset(n)!=="svelte-1pmxqkj"&&(n.textContent=o),this.h()},h(){attr(t,"class","example-dialog")},m(i,u){insert_hydration(i,t,u),insert_hydration(i,a,u),insert_hydration(i,n,u),s||(r=listen(n,"click",e[16]),s=!0)},p:noop,d(i){i&&(detach(t),detach(a),detach(n)),s=!1,r()}}}function create_fragment(e){let t,l,a,n,o,s,r,i,u,g,S,h,P="Ejecutar",I,f,D="Limpiar",x,$,O="Mostrar Ejemplo",T,y,E,w,b,R=`.example-dialog {\r
        background-color: #c8e6c9;\r
        border: 1px solid #ddd;\r
        padding: 10px;\r
        margin-top: 10px;\r
      }\r
\r
      /* Estilos para el código de ejemplo */\r
      .example-code {\r
        background-color: #c8e6c9; /* Verde claro */\r
        color: black; /* Texto en negro */\r
        padding: 10px;\r
        border-radius: 4px;\r
        overflow: auto;\r
        width: 450px; /* Ancho de 150px */\r
      }\r
\r
      main {\r
        display: flex;\r
        flex-direction: column;\r
        align-items: center;\r
      }\r
\r
      textarea {\r
        width: 800px;\r
        height: 200px;\r
        margin-bottom: 10px;\r
      }\r
\r
      button {\r
        padding: 8px 16px;\r
        cursor: pointer;\r
      }\r
\r
      .result {\r
        margin-top: 10px;\r
      }\r
\r
      pre {\r
        background-color: #c8e6c9;\r
        padding: 10px;\r
        border-radius: 4px;\r
        overflow: auto;\r
      }`,C,N,q;function W(c,p){return currentLo?create_if_block_2:create_else_block}let L=W()(e);r=new PageTransition({props:{url:e[4],$$slots:{default:[create_default_slot]},$$scope:{ctx:e}}});let d=e[2]&&create_if_block_1(e),_=e[3]&&create_if_block(e);return{c(){L.c(),t=empty(),l=space(),a=element("div"),n=element("div"),o=space(),s=element("div"),create_component(r.$$.fragment),i=space(),u=element("main"),g=element("textarea"),S=space(),h=element("button"),h.textContent=P,I=space(),f=element("button"),f.textContent=D,x=space(),$=element("button"),$.textContent=O,T=space(),y=element("div"),d&&d.c(),E=space(),_&&_.c(),w=space(),b=element("style"),b.textContent=R,this.h()},l(c){const p=head_selector("svelte-1eh3ggs",document_1.head);L.l(p),t=empty(),p.forEach(detach),l=claim_space(c),a=claim_element(c,"DIV",{id:!0,class:!0});var v=children(a);n=claim_element(v,"DIV",{id:!0}),children(n).forEach(detach),o=claim_space(v),s=claim_element(v,"DIV",{class:!0});var k=children(s);claim_component(r.$$.fragment,k),i=claim_space(k),u=claim_element(k,"MAIN",{});var m=children(u);g=claim_element(m,"TEXTAREA",{placeholder:!0}),children(g).forEach(detach),S=claim_space(m),h=claim_element(m,"BUTTON",{style:!0,"data-svelte-h":!0}),get_svelte_dataset(h)!=="svelte-12hqvzz"&&(h.textContent=P),I=claim_space(m),f=claim_element(m,"BUTTON",{style:!0,"data-svelte-h":!0}),get_svelte_dataset(f)!=="svelte-z8mf0b"&&(f.textContent=D),x=claim_space(m),$=claim_element(m,"BUTTON",{"data-svelte-h":!0}),get_svelte_dataset($)!=="svelte-1nvyxto"&&($.textContent=O),T=claim_space(m),y=claim_element(m,"DIV",{class:!0});var K=children(y);d&&d.l(K),K.forEach(detach),E=claim_space(m),_&&_.l(m),m.forEach(detach),w=claim_space(k),b=claim_element(k,"STYLE",{"data-svelte-h":!0}),get_svelte_dataset(b)!=="svelte-15fzjvr"&&(b.textContent=R),k.forEach(detach),v.forEach(detach),this.h()},h(){attr(n,"id","top"),attr(g,"placeholder","Ingrese su código aquí"),set_style(h,"background-color","#007bff"),set_style(h,"color","white"),set_style(f,"background-color","#7b0000"),set_style(f,"color","white"),set_style(f,"margin-top","20px"),attr(y,"class","result"),attr(s,"class","mx-auto my-4"),attr(a,"id","app"),attr(a,"class","h-full overflow-hidden")},m(c,p){L.m(document_1.head,null),append_hydration(document_1.head,t),insert_hydration(c,l,p),insert_hydration(c,a,p),append_hydration(a,n),append_hydration(a,o),append_hydration(a,s),mount_component(r,s,null),append_hydration(s,i),append_hydration(s,u),append_hydration(u,g),set_input_value(g,e[1]),append_hydration(u,S),append_hydration(u,h),append_hydration(u,I),append_hydration(u,f),append_hydration(u,x),append_hydration(u,$),append_hydration(u,T),append_hydration(u,y),d&&d.m(y,null),append_hydration(u,E),_&&_.m(u,null),append_hydration(s,w),append_hydration(s,b),C=!0,N||(q=[listen(g,"input",e[13]),listen(h,"click",e[5]),listen(f,"click",e[14]),listen($,"click",e[15])],N=!0)},p(c,[p]){const v={};p&16&&(v.url=c[4]),p&131072&&(v.$$scope={dirty:p,ctx:c}),r.$set(v),p&2&&set_input_value(g,c[1]),c[2]?d?d.p(c,p):(d=create_if_block_1(c),d.c(),d.m(y,null)):d&&(d.d(1),d=null),c[3]?_?_.p(c,p):(_=create_if_block(c),_.c(),_.m(u,null)):_&&(_.d(1),_=null)},i(c){C||(transition_in(r.$$.fragment,c),C=!0)},o(c){transition_out(r.$$.fragment,c),C=!1},d(c){c&&(detach(l),detach(a)),L.d(c),detach(t),destroy_component(r),d&&d.d(),_&&_.d(),N=!1,run_all(q)}}}function instance($$self,$$props,$$invalidate){let $page,$onlineStatus,$currentLo,$transitionKey;component_subscribe($$self,page,e=>$$invalidate(10,$page=e)),component_subscribe($$self,onlineStatus,e=>$$invalidate(11,$onlineStatus=e)),component_subscribe($$self,currentLo,e=>$$invalidate(0,$currentLo=e)),component_subscribe($$self,transitionKey,e=>$$invalidate(4,$transitionKey=e));let{$$slots:slots={},$$scope}=$$props;const currentURL=import.meta.url;currentURL.substring(0,currentURL.lastIndexOf("/"));let currentRoute="",{data}=$$props,{supabase,session}=data;function updatePageCount(){!document.hidden&&!currentRoute.startsWith("/live")&&!currentRoute.startsWith("/dashboard")&&analyticsService.updatePageCount(session)}onMount(()=>{console.log(import.meta.url),setInitialClassState(),initServices(data.session),setInterval(updatePageCount,30*1e3)});let code="",result="",showExampleDialog=!1;function executeCode(){try{const cleanedCode=code.replace(/\n/g," ");$$invalidate(2,result=eval(cleanedCode))}catch(e){$$invalidate(2,result=e.message)}}function navigateToNewPage(){$$invalidate(3,showExampleDialog=!1),$$invalidate(2,result="")}function showExample(){$$invalidate(3,showExampleDialog=!0)}let presenceSetup=!1;function setupPresenceLocally(){setupPresence(supabase,$page.params.courseid),setTimeout(()=>{$$invalidate(9,presenceSetup=!0)},1e3)}function unsubscribePresenceLocally(){unsubscribePresence(),$$invalidate(9,presenceSetup=!1)}page.subscribe(e=>{if(e.route.id&&(currentRoute=e.route.id),e.params.courseid&&getKeys().firebase.apiKey!=="XXX"&&analyticsService.learningEvent(e.params,session),e.url.hash&&!e.url.hash.startsWith("#access_token")){const t=document.querySelector(`[id="${e.url.hash}"]`);t&&t.scrollIntoView({behavior:"smooth"})}}),afterNavigate(e=>{if(!$page.url.hash){const t=e.from&&e.to&&e.from.route.id!==e.to.route.id,l=document.querySelector("#page");t&&l!==null&&(l.scrollTop=0)}});function textarea_input_handler(){code=this.value,$$invalidate(1,code)}const click_handler=()=>navigateToNewPage(),click_handler_1=()=>showExample(),click_handler_2=()=>$$invalidate(3,showExampleDialog=!1);return $$self.$$set=e=>{"data"in e&&$$invalidate(8,data=e.data),"$$scope"in e&&$$invalidate(17,$$scope=e.$$scope)},$$self.$$.update=()=>{$$self.$$.dirty&2816&&(!presenceSetup&&data.session&&$onlineStatus?setupPresenceLocally():!$onlineStatus&&presenceSetup&&unsubscribePresenceLocally()),$$self.$$.dirty&2817&&$currentLo&&data.session&&presenceSetup&&($onlineStatus||$onlineStatus===void 0)&&updatePresence({studentName:session.user.user_metadata.full_name,studentEmail:session.user.user_metadata.email,studentImg:session.user.user_metadata.avatar_url,courseTitle:get_store_value(currentLo).parentLo?get_store_value(currentLo).parentLo.title:get_store_value(currentLo).title,loTitle:get_store_value(currentLo).title,loImage:get_store_value(currentLo).img,loRoute:get_store_value(currentLo).route,loIcon:get_store_value(currentLo).icon}),$$self.$$.dirty&3840&&$onlineStatus&&data.session&&presenceSetup&&($onlineStatus||$onlineStatus===void 0)&&subscribePresence({studentName:session.user.user_metadata.full_name,studentEmail:session.user.user_metadata.email,studentImg:session.user.user_metadata.avatar_url,courseTitle:get_store_value(currentLo).parentLo?get_store_value(currentLo).parentLo.title:get_store_value(currentLo).title,loTitle:get_store_value(currentLo).title,loImage:get_store_value(currentLo).img,loRoute:get_store_value(currentLo).route,loIcon:get_store_value(currentLo).icon},$page.params.courseid)},[$currentLo,code,result,showExampleDialog,$transitionKey,executeCode,navigateToNewPage,showExample,data,presenceSetup,$page,$onlineStatus,slots,textarea_input_handler,click_handler,click_handler_1,click_handler_2,$$scope]}class Layout extends SvelteComponent{constructor(t){super(),init(this,t,instance,create_fragment,safe_not_equal,{data:8})}}export{Layout as component};
